<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Portfolio Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f9fafb;
    color: #111827;
  }
  .card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border-bottom: 1px solid #e5e7eb;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #f3f4f6;
    font-weight: bold;
  }
</style>
</head>
<body class="p-6">
  <header class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800">ðŸ“Š Portfolio Dashboard</h1>
    <p class="text-gray-500">Live data from Google Sheets</p>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <!-- Summary Cards -->
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-700">Total Value</h2>
      <p id="totalValue" class="text-2xl font-bold text-green-600">$0</p>
    </div>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-700">Total Assets</h2>
      <p id="totalAssets" class="text-2xl font-bold text-blue-600">0</p>
    </div>
    <div class="card">
      <h2 class="text-lg font-semibold text-gray-700">Top Holding</h2>
      <p id="topHolding" class="text-2xl font-bold text-purple-600">N/A</p>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Chart -->
    <div class="card">
      <h2 class="text-lg font-semibold mb-2">Portfolio Allocation</h2>
      <canvas id="portfolioChart" height="200"></canvas>
    </div>
    <!-- Table -->
    <div class="card">
      <h2 class="text-lg font-semibold mb-2">Portfolio Details</h2>
      <div id="data" class="overflow-x-auto"></div>
    </div>
  </div>

<script>
const sheetID = '1iB2Da6LsLo8TIwt25aco8BVztH8cotAwQ_pPNy1KQZM';
const apiKey = 'AIzaSyAST1C5gv-tfAN1P51phbvqefEFKJM8G4w';
const range = 'A1:E20'; // Example: A=Asset, B=Quantity, C=Price, D=Value

const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${range}?key=${apiKey}`;

fetch(url)
  .then(response => response.json())
  .then(data => {
    if (!data.values) {
      document.getElementById('data').innerHTML = '<p>No data found.</p>';
      return;
    }

    const rows = data.values;
    const headers = rows[0];
    const entries = rows.slice(1);

    // Build Table
    let html = '<table><thead><tr>';
    headers.forEach(h => html += `<th>${h}</th>`);
    html += '</tr></thead><tbody>';
    entries.forEach(row => {
      html += '<tr>';
      row.forEach(cell => html += `<td>${cell}</td>`);
      html += '</tr>';
    });
    html += '</tbody></table>';
    document.getElementById('data').innerHTML = html;

    // Calculate Summary
    let totalValue = 0;
    let assets = [];
    entries.forEach(row => {
      const asset = row[0];
      const value = parseFloat(row[3] || 0);
      totalValue += value;
      assets.push({ name: asset, value: value });
    });

    document.getElementById('totalValue').textContent = `$${totalValue.toLocaleString()}`;
    document.getElementById('totalAssets').textContent = entries.length;
    const top = assets.sort((a,b) => b.value - a.value)[0];
    document.getElementById('topHolding').textContent = top ? top.name : 'N/A';

    // Chart.js
    const ctx = document.getElementById('portfolioChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: assets.map(a => a.name),
        datasets: [{
          data: assets.map(a => a.value),
          backgroundColor: ['#4F46E5','#10B981','#F59E0B','#EF4444','#6366F1','#14B8A6']
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });
  })
  .catch(error => {
    console.error('Error:', error);
    document.getElementById('data').innerHTML = '<p>Error loading data.</p>';
  });
</script>
</body>
</html>
